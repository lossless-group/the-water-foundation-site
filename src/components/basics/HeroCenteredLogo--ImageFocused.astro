---
import ButtonPrimary from './buttons/Button--Primary.astro';
import ButtonSecondary from './buttons/Button--Secondary.astro';
import ButtonAccent from './buttons/Button--Accent.astro'
import ButtonVariants from './buttons/Button--Variants.astro';

interface BackgroundItem {
  type: 'image' | 'video' | 'gif' | 'color';
  src?: string;
  alt?: string;
  overlay?: boolean;
  overlayOpacity?: number;
  overlayGradient?: string;
  position?: string;
  size?: string;
  repeat?: string;
  attachment?: string;
  videoSrc?: string;
}

interface Props {
  contextSetterTxt?: string;
  headerTxt?: string;
  headerLogoSrc?: string;
  subHeaderTxt?: string;
  supportingCopyTxt?: string;
  targetActionsArray?: Array<{
    text: string;
    href: string;
    type: 'primary' | 'secondary' | 'accent';
    size?: 'sm' | 'md' | 'lg';
    external?: boolean;
  }>;
  backgroundsArray?: BackgroundItem[];
  backgroundImageUrl?: string; // For backward compatibility
  paddingClasses?: string; // For custom padding
}

const {
  contextSetterTxt = '',
  headerTxt = '',
  headerLogoSrc = '',
  subHeaderTxt = '',
  supportingCopyTxt = '',
  targetActionsArray = [],
  backgroundsArray = [],
  backgroundImageUrl = '',
  paddingClasses = 'py-8 md:py-12 lg:py-16' // Default padding
} = Astro.props;

// For backward compatibility, use backgroundImageUrl if no backgroundsArray is provided
const backgrounds: BackgroundItem[] = backgroundsArray.length > 0 
  ? backgroundsArray 
  : [{ 
      type: 'image' as const, 
      src: backgroundImageUrl || '/images/hero-bg.jpg',
      overlay: true,
      overlayOpacity: 0.4
    }];

// Function to get background classes based on background type
const getBackgroundClasses = (bg: BackgroundItem) => {
  const classes = [];
  
  if (bg.position) classes.push(`bg-${bg.position}`);
  if (bg.size) classes.push(`bg-${bg.size}`);
  if (bg.repeat) classes.push(`bg-${bg.repeat}`);
  if (bg.attachment) classes.push(`bg-${bg.attachment}`);
  
  return classes.join(' ');
};
---

<section class="relative h-screen flex flex-col overflow-hidden">
  <!-- Background Container - Full width, no margins, with controlled overflow -->
  <div class="backgrounds-container absolute inset-0 w-full h-full">
    {backgrounds.map((bg, index) => {
      const backgroundClasses = getBackgroundClasses(bg);
      const isFirst = index === 0;
      
      return (
        <div 
          class={`background-item absolute inset-0 transition-opacity duration-1000 ease-in-out ${backgroundClasses} ${isFirst ? 'opacity-100' : 'opacity-0'}`}
          style={`
            z-index: 1;
            ${bg.type === 'image' ? `background-image: url('${bg.src}')` : ''}
          `}
          aria-hidden={!isFirst}
        >
          {bg.type === 'gif' && bg.src && (
            <img
              src={bg.src}
              alt={bg.alt || 'Background animation'}
              class="absolute inset-0 w-full h-auto min-h-full object-contain md:object-cover"
              style="object-position: center top"
            />
          )}
          
          {bg.type === 'video' && bg.src && (
            <video
              class="absolute inset-0 w-full h-auto min-h-full object-contain md:object-cover"
              style="object-position: center top"
              autoplay
              muted
              loop
              playsinline
            >
              <source src={bg.src} type="video/mp4" />
            </video>
          )}
          
          {bg.type === 'image' && bg.src && (
            <img
              src={bg.src}
              alt={bg.alt || 'Background'}
              class={`absolute w-full h-auto min-h-full object-contain md:object-cover transition-opacity duration-1000 ease-in-out ${isFirst ? 'opacity-100' : 'opacity-0'}`}
              style="object-position: center top"
              aria-hidden={!isFirst}
            />
          )}
          
          {bg.overlay && (
            <div 
              class="absolute inset-0"
              style={`
                z-index: 2;
                ${bg.overlayGradient 
                  ? `background: ${bg.overlayGradient}` 
                  : 'background-color: rgba(0, 0, 0, 0.4)'
                };
                opacity: ${bg.overlayOpacity || 0.4};
              `}
            ></div>
          )}
        </div>
      );
    })}
  </div>

  <!-- Centered Logo -->
  <div class="relative z-10 flex-1 flex flex-col items-center justify-center p-4">
    {/* Space above logo */}
    <div class="flex-1"></div>
    
    {/* Center column: App icon (big) on top, wordmark below */}
    <div class="max-w-2xl w-full mx-auto text-center">
      <div class="inline-flex flex-col items-center gap-6">
        <img
          src="/appIcon__The-Water-Foundation--Darkest.svg"
          alt="The Water Foundation icon"
          class="mx-auto object-contain w-32 h-32 md:w-40 md:h-40 lg:w-48 lg:h-48 xl:w-56 xl:h-56 filter brightness-[.7]"
          loading="eager"
          decoding="async"
          fetchpriority="high"
        />
        <img
          src="/wordmark__The-Water-Foundation--Darker--Wide.svg"
          alt="The Water Foundation wordmark"
          class="mx-auto object-contain w-[min(90vw,56rem)] h-auto filter brightness-[.7]"
          loading="eager"
          decoding="async"
          fetchpriority="high"
        />
      </div>
    </div>
    
    {/* Space below logo */}
    <div class="flex-1"></div>
  </div>

  <!-- Bottom Content -->
  <div class="relative z-10 w-full max-w-7xl mx-auto px-6 pb-16">
    <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-8 lg:gap-16">
      <!-- Left side: Text content -->
      <div class="flex-1 text-left space-y-6 max-w-2xl">
        {contextSetterTxt && (
          <a href="/impact" class="inline-block">
            <div class="inline-flex items-center px-3 py-1.5 rounded-full bg-accent-100/90 border border-accent-200/50 backdrop-blur-sm hover:bg-accent-200/70 transition-colors">
              <span class="text-xs font-medium text-accent-800 tracking-wide uppercase">
                {contextSetterTxt}
              </span>
            </div>
          </a>
        )}
        
        <div class="space-y-4">
          {headerTxt && (
            <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-white leading-tight tracking-tight">
              {headerTxt}
            </h1>
          )}
          
          {subHeaderTxt && (
            <p class="text-lg md:text-xl text-white/90 font-medium leading-relaxed">
              {subHeaderTxt}
            </p>
          )}
          
          {supportingCopyTxt && (
            <p class="text-base md:text-lg text-white/80 leading-relaxed max-w-2xl">
              {supportingCopyTxt}
            </p>
          )}
        </div>
      </div>

      <!-- Right side: CTA Buttons -->
      {targetActionsArray.length > 0 && (
        <div class="flex flex-col gap-4">
          {targetActionsArray.map((action, index) => {
            // Accent button has a different API (uses `text` prop instead of slot)
            if (action.type === 'accent') {
              return (
                <ButtonAccent
                  href={action.href}
                  text={action.text}
                  external={action.external}
                  className="w-full"
                />
              );
            }

            const ButtonComponent = action.type === 'primary' ? ButtonPrimary : ButtonSecondary;
            return (
              <ButtonComponent
                href={action.href}
                size={action.size || 'md'}
                external={action.external}
                className="w-full"
              >
                {action.text}
              </ButtonComponent>
            );
          })}
        </div>
      )}
    </div>
  </div>
</section>
