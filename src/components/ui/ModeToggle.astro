---
// ModeToggle.astro - A theme toggle button component
---

<button 
  type="button"
  class="mode-toggle p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors w-10 h-10 flex items-center justify-center"
  title="Toggle dark/light mode"
  aria-label="Toggle dark mode"
  data-theme-toggle
>
  <picture>
    <source
      srcset="/icons/moon.svg"
      media="(prefers-color-scheme: dark)"
      width="20"
      height="20"
    />
    <img
      src="/icons/sun.svg"
      alt="Theme toggle icon"
      width="20"
      height="20"
      class="w-5 h-5"
      data-theme-icon
    />
  </picture>
</button>

<script is:inline>
  // Toggle between light and dark mode
  function toggleMode() {
    const currentMode = document.documentElement.getAttribute('data-mode');
    const newMode = currentMode === 'dark' ? 'light' : 'dark';
    
    // Update the data-mode attribute
    document.documentElement.setAttribute('data-mode', newMode);
    
    // Save preference to localStorage
    localStorage.setItem('mode', newMode);
    
    // Update button state
    updateButton(newMode === 'dark');
  }
  
  // Update button state
  function updateButton(isDark) {
    const button = document.querySelector('.mode-toggle');
    if (!button) return;
    
    button.setAttribute('aria-pressed', isDark);
    button.setAttribute('aria-label', isDark ? 'Switch to light mode' : 'Switch to dark mode');
    button.setAttribute('title', isDark ? 'Switch to light mode' : 'Switch to dark mode');
  }
  
  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    // Handle button click
    document.addEventListener('click', (event) => {
      if (event.target.closest('[data-theme-toggle]')) {
        toggleMode();
      }
    });
  });
</script>
