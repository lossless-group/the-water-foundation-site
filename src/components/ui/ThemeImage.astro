---
// src/components/ui/ThemeImage.astro

interface Props {
  lightSrc: string;
  darkSrc?: string;
  alt: string;
  width?: string | number;
  height?: string | number;
  class?: string;
  loading?: 'eager' | 'lazy';
}

const {
  lightSrc,
  darkSrc,
  alt,
  width,
  height,
  class: className = '',
  loading = 'lazy'
} = Astro.props as Props;

const hasDarkVariant = !!darkSrc && darkSrc !== lightSrc;

// Helper to safely convert to string attributes
const attr = (value?: string | number) => 
  value !== undefined ? String(value) : undefined;
---

<div class="theme-image-container">
  <img
    src={lightSrc}
    alt={alt}
    class:list={['light-image', className]}
    loading={loading}
    width={attr(width)}
    height={attr(height)}
  />
  {hasDarkVariant && (
    <img
      src={darkSrc}
      alt={alt}
      class:list={['dark-image', 'hidden', className]}
      loading={loading}
      width={attr(width)}
      height={attr(height)}
    />
  )}
</div>

<style>
  .theme-image-container {
    position: relative;
  }

  /* Default: show light image, hide dark image */
  .light-image {
    display: block;
  }
  
  .dark-image {
    display: none;
  }

  /* Dark mode: hide light image, show dark image */
  :global(.dark) .light-image {
    display: none;
  }
  
  :global(.dark) .dark-image {
    display: block !important;
  }

  /* System preference dark mode fallback */
  @media (prefers-color-scheme: dark) {
    .light-image {
      display: none;
    }
    .dark-image {
      display: block !important;
    }
    
    /* Override if explicitly in light mode */
    :global(.light) .light-image {
      display: block;
    }
    :global(.light) .dark-image {
      display: none !important;
    }
  }
  
  /* Smooth transitions */
  .light-image,
  .dark-image {
    transition: opacity 0.2s ease-in-out;
  }
</style>
